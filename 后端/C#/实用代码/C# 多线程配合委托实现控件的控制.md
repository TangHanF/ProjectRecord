> ä½œè€…ï¼šTangHanFï¼ˆGuoFuï¼‰
>
> æ—¥æœŸï¼š2018å¹´7æœˆ6æ—¥
>
> è¯´æ˜ï¼šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼ğŸ¤
>
> è”ç³»æ–¹å¼ï¼šguofu_gh@163.com

-----

# å‰è¨€

> â€‹	åœ¨C#çš„Winformå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šæ—¶å€™éœ€è¦ç”¨åˆ°å¤šçº¿ç¨‹ä»¥åŠ å¿«å¤„ç†é€Ÿåº¦ï¼Œå½“ç„¶äº†ï¼Œå¤šçº¿ç¨‹éœ€è¦æ ¹æ®æƒ…å†µåˆç†ä½¿ç”¨æ‰èƒ½ä½“ç°å‡ºå®ƒçš„ä»·å€¼ã€‚æœŸé—´å¯¹äºæ–°æ‰‹æ¥è¯´å¸¸å¸¸ä¼šé‡åˆ°è·¨çº¿ç¨‹è°ƒç”¨æ§ä»¶æ‰€å‡ºç°çš„é”™è¯¯ï¼Œè¿™é‡Œéœ€è¦è¯´æ˜ä¸€ä¸‹ï¼š
>
> â€‹	â€œWindows çª—ä½“â€ä½¿ç”¨å•çº¿ç¨‹å•å…ƒ (STA) æ¨¡å‹ï¼Œå› ä¸ºâ€œWindows çª—ä½“â€åŸºäºæœ¬æœº Win32 çª—å£ï¼Œè€Œ Win32 çª—å£ä»æœ¬è´¨ä¸Šè€Œè¨€æ˜¯å•å…ƒçº¿ç¨‹ã€‚STA æ¨¡å‹æ„å‘³ç€å¯ä»¥åœ¨ä»»ä½•çº¿ç¨‹ä¸Šåˆ›å»ºçª—å£ï¼Œä½†çª—å£ä¸€æ—¦åˆ›å»ºåå°±ä¸èƒ½åˆ‡æ¢çº¿ç¨‹ï¼Œå¹¶ä¸”å¯¹å®ƒçš„æ‰€æœ‰å‡½æ•°è°ƒç”¨éƒ½å¿…é¡»åœ¨å…¶åˆ›å»ºçº¿ç¨‹ä¸Šå‘ç”Ÿã€‚é™¤äº† Windows çª—ä½“ä¹‹å¤–ï¼Œ.NET Framework ä¸­çš„ç±»ä½¿ç”¨è‡ªç”±çº¿ç¨‹æ¨¡å‹ã€‚
>
> **	STA æ¨¡å‹è¦æ±‚éœ€ä»æ§ä»¶çš„éåˆ›å»ºçº¿ç¨‹è°ƒç”¨çš„æ§ä»¶ä¸Šçš„ä»»ä½•æ–¹æ³•å¿…é¡»è¢«å°é€åˆ°ï¼ˆåœ¨å…¶ä¸Šæ‰§è¡Œï¼‰è¯¥æ§ä»¶çš„åˆ›å»ºçº¿ç¨‹**ã€‚åŸºç±» Control ä¸ºæ­¤ç›®çš„æä¾›äº†è‹¥å¹²æ–¹æ³•ï¼ˆInvokeã€BeginInvoke å’Œ EndInvokeï¼‰ã€‚Invoke ç”ŸæˆåŒæ­¥æ–¹æ³•è°ƒç”¨ï¼›BeginInvoke ç”Ÿæˆå¼‚æ­¥æ–¹æ³•è°ƒç”¨ã€‚ Â Â   
>
> â€‹	Windows çª—ä½“ä¸­çš„æ§ä»¶è¢«ç»‘å®šåˆ°ç‰¹å®šçš„çº¿ç¨‹ï¼Œä¸å…·å¤‡çº¿ç¨‹å®‰å…¨æ€§ã€‚
>
> â€‹	å› æ­¤ï¼Œ**å¦‚æœä»å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨æ§ä»¶çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå¿…é¡»ä½¿ç”¨æ§ä»¶çš„ä¸€ä¸ª Invoke æ–¹æ³•æ¥å°†è°ƒç”¨å°é€åˆ°é€‚å½“çš„çº¿ç¨‹**

â€‹	åœ¨æ­¤æˆ‘å°†å¤šçº¿ç¨‹å¤„ç†UIæ§ä»¶çš„æµç¨‹ç®€å•æ¢³ç†ä¸€ä¸‹ã€‚

# 1ã€å£°æ˜å§”æ‰˜

```C#
// å®šä¸€ä¸ªå§”æ‰˜ï¼Œæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œç„¶åvoid
private delegate void ChangeLabelText(string msg);
```



# 2ã€åˆ›å»ºçº¿ç¨‹ã€å¯åŠ¨çº¿ç¨‹

```C#
Thread thread = new Thread(new ThreadStart(æ–¹æ³•å));
thread.Start();
```

# 3ã€å®ä¾‹åŒ–å§”æ‰˜ï¼ˆå³å°†å§”æ‰˜æŒ‡å‘ä¸€ä¸ªå…·ä½“æ–¹æ³•ï¼‰

# 4ã€è°ƒç”¨å§”æ‰˜



# å…·ä½“ä»£ç 

> å¯åŠ¨ä¸€ä¸ªå¾ªç¯ï¼Œæ¯æ¬¡å¾ªç¯å°†ç»“æœèµ‹å€¼ç»™çª—ä½“ä¸Šçš„Labelæ ‡ç­¾ï¼Œå®Œæˆä¹‹åä¿®æ”¹Labelæ ‡ç­¾å€¼ä¸ºâ€œå®Œæˆâ€

å¯èƒ½æ–°æ‰‹å¼€å§‹ä¼šè¿™ä¹ˆåšï¼š

```C#
private void button1_Click(object sender, EventArgs e)
{
	Thread thread = new Thread(new ThreadStart(Test));
	thread.Start();
}


public void Test()
{
	for (int i = 0; i < 1000; i++)
	{
		Console.WriteLine(i);
        label1.Text=i.toString();// æ”¾å¿ƒï¼Œæ­¤å¤„ä¼šæŠ¥é”™ï¼Œä¸ä¿¡å°è¯•ä¸€ä¸‹
	}
}
```

ä»¥ä¸Šä»£ç çœ‹ä¼¼é¡ºç†æˆç« ï¼Œåˆ›å»ºçº¿ç¨‹â€”å¯åŠ¨çº¿ç¨‹â€”çº¿ç¨‹çš„æ–¹æ³•è¿›è¡Œå¾ªç¯ï¼ŒåŒæ—¶ä¿®æ”¹Labelå€¼ï¼Œä½†æ˜¯å­˜åœ¨é—®é¢˜ï¼Œæ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯ï¼š

```c#
// å£°æ˜å§”æ‰˜
private delegate void ChangeLabelText(string msg);


private void button1_Click(object sender, EventArgs e)
{
	Thread thread = new Thread(new ThreadStart(Test));
	thread.Start();
}


public void ModifyLabel(string text)
{
	label1.Text = text;
}

public void Test()
{
    // å®ä¾‹åŒ–å§”æ‰˜ï¼Œå°†å§”æ‰˜ä¸ModifyLabelæ–¹æ³•ç»‘å®š
	ChangeLabelText changeLabelText = ModifyLabel;
	for (int i = 0; i < 1000; i++)
	{
		Console.WriteLine(i);
        // é€šè¿‡æ§ä»¶çš„Invokeè°ƒç”¨å§”æ‰˜
		label1.Invoke(changeLabelText, new object[] { i.ToString() });
	}
	label1.Invoke(changeLabelText, new object[] { "å®Œæˆ" });
}
```

